<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Takeaway</title>
    
   
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Bellota+Text:wght@300;400;700&family=Comfortaa:wght@300;400;500&family=Fira+Code:wght@300;400;500&family=Major+Mono+Display&family=Montserrat:wght@200;300;400;500&family=Quicksand:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/caae6b21c5.js" crossorigin="anonymous"></script>
    
     <link rel="stylesheet" href="/sass/main.css">
    <link rel="stylesheet" href="/sass/restaurant.css">
     <link rel="stylesheet" href="/sass/nfc.css">
     <link rel="stylesheet" href="/sass/cart.css">

</head>
<body>
    <div class="loader-holder">
        <div class="loader">
           <lottie-player src="https://assets5.lottiefiles.com/packages/lf20_jwdccuex.json"  background="transparent"  speed="1"  style="width: 160px; height: 160px;"  loop  autoplay></lottie-player>
        </div>
    </div>


    <div class="popup successP">
        <lottie-player src="https://assets10.lottiefiles.com/packages/lf20_rc5d0f61.json"  background="transparent"  speed="1"  style="width: 100px; height: 100px;"    autoplay></lottie-player>
        <h1>Payment Successfull</h1>
        <p>Please wait for the restaurant to accept the order</p>
    </div>

    <div class="takeaway-div">

        <button class="categories-btn">Categories</button>

    <div class="ovf-div"></div>

    <div class="categories-div" style="display : none;">
            <ul class="catUl">
               
                



            </ul>
    </div>  
        <div class="head-div">
            <h1><i class="fa-solid fa-angle-left" onclick="history.go(-1)"></i>Takeaway</h1>
          <p>Please choose food for takeaway from below menu</p>
        </div>
          
         <div class="menu-items">
        <div class="filter-div">
            <div class="veg" data-tab-category="Veg" data-tab-status="inactive"><span>Veg</span></div>
            <div class="non-veg" data-tab-category="Non-veg" data-tab-status="inactive"><span>Non Veg</span></div>

        </div>
        <div class="menu-wrap-con-takeaway"></div>
                
        </div>

        


    <div class="cart-absolute-div">

                <div class="det-div">
                  <h4 class="item-count-abs">0 ITEM</h4>
                <h4 class="grand-total-abs ">₹ 0</h4>
                <h4 class="ab-h4">plus taxes</h4>
                </div>
                
                <h2>View Cart <i class="bi bi-caret-right-fill"></i></h2>

              </div>
    </div> 

    <div class="content-side-section-cart" style="top: 100%; display: none; opacity: 0;">
                 <div class="cart-con">
                    <h2><i class="fa-solid fa-angle-left" onclick="closeCartMobile()"></i>Your Cart</h2>
                   
                   <img class="empty-cart" src="/images/emptyCart.png" alt="" srcset="" >

                   <div class="food-items-holder"></div>

                    <hr>
                    <button class="add-more-food" onclick="closeCartMobile()"><i class="bi bi-plus"></i> Add more food</button>
                    <hr>
                  <div class="total-div">
                    <h2>Total</h2>
                  
                    <div class="cal-div">
                        <div class="sub-total"><h4>Sub Total : </h4> <p class="sub-total-text ">0 ₹</p></div>
                        <div class="tax"><h4>Taxes & Charges : </h4> <p class="tax-text ">0 ₹</p></div>
                    </div>

                    <div class="grand-total"><h4>Grand Total : </h4> <p class="grand-total-text ">0 ₹</p></div>


                </div>
                <button class="order-btn">Proceed to pay</button>
                 </div>
               </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js" integrity="sha512-H6cPm97FAsgIKmlBA4s774vqoN24V5gSQL4yBTDOY2su2DeXZVhQPxFK4P6GPdnZqM9fg1G3cMv5wD7e6cFLZQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
<script>
  //  window.addEventListener('scroll', function (){

    //let nav = document.querySelector('.heading');
    //let landingDiv = document.querySelector('.landing-div');


    //let windowPosition = window.scrollY > 100;
  //  nav.classList.toggle('head-scroll', windowPosition);


//})

const scrollToDiv = ()=>{
    const elem = document.querySelector("#BurgerScroll");

    elem.scrollIntoView({behavior : "smooth"})

}
const tl3 = new TimelineLite()



    const catDiv = document.querySelector('.categories-div');
    const ovfDiv2 = document.querySelector('.ovf-div');
    const catBtn = document.querySelector('.categories-btn');

    
    catBtn.addEventListener('click', ()=>{
        if(catDiv.style.display == "none"){
         tl3.to(catDiv,0,{
        display : "block"
    },)
     tl3.to(ovfDiv2,0,{
        display : "block",
        top : 0,
        zIndex : "1"
    },)
    document.body.classList.add('ovf');
    catBtn.innerHTML = "Close"
    }else{

          tl3.to(catDiv,0,{
        display : "none"
    },)
     tl3.to(ovfDiv2,0,{
        display : "none",
        top : window.scrollY
    },)
    document.body.classList.add('ovf');
    catBtn.innerHTML = "Categories"

    }
    })
    
     document.addEventListener('mouseup', function(e) {

          try {

              

          if (!catDiv.contains(e.target) && !catBtn.contains(e.target) ) {
               
                            tl3.to(catDiv,0,{
                            display : "none"
                        },)
                        tl3.to(ovfDiv2,0,{
                            display : "none",
                            top : window.scrollY
                        },)
                        catBtn.innerHTML = "Categories"
          }
          
          } catch (error) {
               
          }
          
          
      });
   

</script>
<script>
let id = window.location.href.substring(window.location.href.indexOf('/restaurants') + 1).split(['/'])[1].split(['?'])[0]
const menuWrapCon = document.querySelector('.menu-wrap-con-takeaway');


menuWrapCon.addEventListener('click' , (e)=>{

    if(e.target.name == "quantity"){
        let itemPrice = document.querySelector('.item-price');
        let div = e.target.closest('.menu-item');
        let div2 = div.querySelector('.item-price')
        
        div2.innerHTML =  `₹${e.target.dataset.tabPrice}`




    }
})



let finalData;

let categories = [];
let a = 0;

const fillMenu = ()=>{
    menuWrapCon.innerHTML = ''
    finalData.menuData.menu.forEach(element => {
        if(!categories.includes(element.category)){
            categories.push(element.category)
        }

    });
    document.querySelector('.catUl').innerHTML = ''
    categories.forEach((element,index )=>{

        finalData.menuData.menu.forEach(e =>{
            if(element == e.category){
                a += 1;
            }


        })
        document.querySelector('.catUl').innerHTML += `<li id="${element}">${element} (${a})</li>`
        let containerData = `<div class="specify-div" >
            <button class="specify-head"  data-tab-target="${element}" data-tab-status="open">${element} (${a}) <i class="bi bi-caret-down-fill"></i></button>
            <div class="menu-inner-wrap-con menu-inner-wrap-con${index}" id="${element}" data-tab-content="${element}"></div>
            </div>
            `
               menuWrapCon.innerHTML += containerData; 
               
        finalData.menuData.menu.forEach(elem=>{

            const containerDiv = document.querySelector(`.menu-inner-wrap-con${index}`);

            
            if(element == elem.category){
                  let typeData;
                  let quantityData = '';
               if(elem.type == "Non-veg"){
                   typeData = `<img src="https://img.icons8.com/fluency/50/000000/non-vegetarian-food-symbol.png" alt="">`
               }else{
                   typeData = `<img src="https://img.icons8.com/fluency/50/000000/non-vegetarian-food-symbol.png" alt="">`
               } 

               
               elem.quantityDetails.forEach((element , index)=>{

                if(index == 0){
                    quantityData += `<div class="quantity-div">
                <input type="radio" name="${elem._id}" value='${element.quantity} ${element.quantityUnit}' data-tab-id=${elem._id} data-tab-price=${element.price} onchange="changeBtn(this)" checked>
                <label for="quantity1">${element.quantity} ${element.quantityUnit}</label>
                </div>`
                }else{
                    quantityData += `<div class="quantity-div">
                <input type="radio" name="${elem._id}" value='${element.quantity} ${element.quantityUnit}' data-tab-id=${elem._id} data-tab-price=${element.price} onchange="changeBtn(this)">
                <label for="quantity1">${element.quantity} ${element.quantityUnit}</label>
                </div>`
                }
                

            })

            let arr = JSON.parse(localStorage.getItem(id)) || []
          
            let btn;
            if(arr.length < 1){
                btn = `<button class="add-to-cart" id="${elem._id}" data-tab-target="addToCart">Add</button>`
            }
                for(let [index,i] of arr.entries()){
                    let quantity = `${elem.quantityDetails[0].quantity} ${elem.quantityDetails[0].quantityUnit}`
                    console.log(quantity);
                    if(i.foodId == elem._id){

                        if(i.foodQuantity == quantity){
                           
                            btn = `<div class="btn-con">
                            <button ><span><i class="bi bi-dash" onclick="removeFromCart('${i.foodId}' , '${i.foodQuantity}' , this);"></i></span></button>
                            <input class="quantity ${i.foodId}" min="1" max="15" name="food-quantity" value="${i.cartQuantity}" type="number"  data-id="${i.foodId}">
                            <button ><span><i class="bi bi-plus" id="${i.foodId}" data-tab-target="addToCart" ></i></span></button>
                            </div>`
                            
                            break;
                        }else{
                            btn = `<button class="add-to-cart" id="${elem._id}" data-tab-target="addToCart">Add</button>`   
                        }

                    }else{
                        
                        if(index == arr.length - 1){
                            btn = `<button class="add-to-cart" id="${elem._id}" data-tab-target="addToCart">Add</button>`
                            
                        }
                    }
                } 
               
                let htmlData = `<div class="menu-item" >
                <div class="item-wrap-con">
                <div class="img-wrap-con">
                        <div class="img-div">
                <img src="/uploads/${elem.cuisineImg}" alt="" srcset="">

                </div>
                </div>
                
                <div class="item-details-div">
                    ${typeData}
                    <span class="item-name">${elem.cuisinename}</span>
                    <span class="item-price ">₹${elem.quantityDetails[0].price}</span>

                    

                </div>
                <div class="add-to-cart-div">
                   ${btn}
                    
                </div>
                </div>
                
           
            <div class="quantity-wrap-div">
                        
                        ${quantityData}
                    </div>
                     <hr>

            </div>`

            containerDiv.innerHTML += htmlData
            quantityData = ''
       

            }   
        })

        a = 0;
    })
    
}
const menuWra = document.querySelectorAll('.menu-wrap-con');
menuWra.forEach(elem => {

})

const menuDataFetch = async()=>{

    const menuData = await fetch(`/menuData/${id}`,{
        method : "GET",
       
    })


    let data = await menuData.json();
    finalData = data;
    console.log(finalData);
    fillMenu()
    

    

    
}
menuDataFetch()

const filterTabs = menuWrapCon.closest('.menu-items').querySelectorAll('[data-tab-category]');

filterTabs.forEach(tab =>{
    tab.addEventListener('click', ()=>{
        a = 0;
        console.log(tab);

        if(tab.dataset.tabCategory == "Veg"){
          console.log(tab)

            if(tab.dataset.tabStatus == "inactive"){
                document.querySelector('.catUl').innerHTML = ''
                let vegData = [];
                let vegCategories = []
                menuWrapCon.innerHTML = '';
                finalData.menuData.menu.forEach(elem =>{
            
                    if(elem.type == "Veg"){
                       vegData.push(elem)
                    }
                    
                    
                    
                    
                    
            
            
            
            
                })
                vegData.forEach(elem =>{
                    if(!vegCategories.includes(elem.category)){
                        vegCategories.push(elem.category)
                    }
                })

                

                vegCategories.forEach((element,index )=>{

                    finalData.menuData.menu.forEach(e =>{
                        if(element == e.category){
                            a += 1;
                        }
            
            
                    })
                    document.querySelector('.catUl').innerHTML += `<li id="${element}">${element} (${a})</li>`
                    let containerData = `<div class="specify-div" >
                        <button class="specify-head"  data-tab-target="${element}" data-tab-status="open">${element} (${a}) <i class="bi bi-caret-down-fill"></i></button>
                        <div class="menu-inner-wrap-con menu-inner-wrap-con${index}" id="${element}" data-tab-content="${element}">
                        </div>
                        </div>
                        `
                           menuWrapCon.innerHTML += containerData; 
                           
                    vegData.forEach(elem=>{
            
                        const containerDiv = menuWrapCon.querySelector(`.menu-inner-wrap-con${index}`);
            
                        
                        if(element == elem.category){
                              let typeData;
                  let quantityData = '';

                           if(elem.type == "Non-veg"){
                               typeData = `<img src="https://img.icons8.com/fluency/50/000000/non-vegetarian-food-symbol.png" alt="">`
                           }else{
                               typeData = `<img src="https://img.icons8.com/fluency/50/000000/non-vegetarian-food-symbol.png" alt="">`
                           } 

                           elem.quantityDetails.forEach((element , index)=>{
                            if(index == 0){
                                quantityData += `<div class="quantity-div">
                                <input type="radio" name="${elem._id}" value='${element.quantity} ${element.quantityUnit}' data-tab-id=${elem._id}  data-tab-price=${element.price} onchange="changeBtn(this)" checked>
                                <label for="quantity1">${element.quantity} ${element.quantityUnit}</label>
                                </div>`
                            }else{
                                quantityData += `<div class="quantity-div">
                                <input type="radio" name="${elem._id}" value='${element.quantity} ${element.quantityUnit}' data-tab-id=${elem._id}  data-tab-price=${element.price} onchange="changeBtn(this)">
                                <label for="quantity1">${element.quantity} ${element.quantityUnit}</label>
                                </div>`
                            }
                           
            
                        })
                            
                        let arr = JSON.parse(localStorage.getItem(id)) || []
                        if(arr.length < 1){
                            btn = `<button class="add-to-cart" id="${elem._id}" data-tab-target="addToCart">Add</button>`
                        }else{
                            for(let [index,i] of arr.entries()){
                            console.log(index);
                            let quantity = `${elem.quantityDetails[0].quantity} ${elem.quantityDetails[0].quantityUnit}`
                            if(i.foodId == elem._id){
        
                                if(i.foodQuantity == quantity){
                                    btn = `<div class="btn-con">
                                    <button ><span><i class="bi bi-dash" onclick="removeFromCart('${i.foodId}' , '${i.foodQuantity}' , this);"></i></span></button>
                                    <input class="quantity ${i.foodId}" min="1" max="15" name="food-quantity" value="${i.cartQuantity}" type="number"  data-id="${i.foodId}">
                                    <button ><span><i class="bi bi-plus" id="${i.foodId}" data-tab-target="addToCart" ></i></span></button>
                                    </div>`
                                    break;

                                }else{
                                     btn = `<button class="add-to-cart" id="${elem._id}" data-tab-target="addToCart">Add</button>`
                                }
        
                            }else{
                                
                                
                                if(index == arr.length - 1) {
                                    btn = `<button class="add-to-cart" id="${elem._id}" data-tab-target="addToCart">Add</button>`
                                }
                            }
                        } 
                        }
                         

                            let htmlData = `<div class="menu-item" >
                            <div class="item-wrap-con">
                            <div class="img-wrap-con">
                                    <div class="img-div">
                            <img src="/uploads/${elem.cuisineImg}" alt="" srcset="">
            
                            </div>
                            </div>
                            
                            <div class="item-details-div">
                                ${typeData}
                                <span class="item-name">${elem.cuisinename}</span>
                                <span class="item-price ">₹${elem.quantityDetails[0].price}</span>
            
                                
            
                            </div>
                            <div class="add-to-cart-div">
                                ${btn}
                                
                            </div>
                            </div>
                            
                       
                        <div class="quantity-wrap-div">
                                    ${quantityData}
            
                                </div>
                                 <hr>
            
                        </div>`
                        containerDiv.innerHTML += htmlData
                        quantityData = ''
            
                        }   
                    })
                })

                tab.style.backgroundColor = "#3ea055"
                tab.style.color = "white"
                tab.style.borderColor = "#3ea055"


                tab.dataset.tabStatus = "active";
            }else{
                tab.style.backgroundColor = "white"
                tab.style.color = "black"
                tab.style.borderColor = "#afafaf"

                tab.dataset.tabStatus = "inactive"
                fillMenu()
            }   
        }else if(tab.dataset.tabCategory == "Non-veg"){
            if(tab.dataset.tabStatus == "inactive"){

                document.querySelector('.catUl').innerHTML = ''
                let vegData = [];
                let vegCategories = []
                menuWrapCon.innerHTML = '';
                finalData.menuData.menu.forEach(elem =>{
            
                    if(elem.type == "Non-veg"){
                       vegData.push(elem)
                    }
                    
                    
                    
                    
                    
            
            
            
            
                })
                vegData.forEach(elem =>{
                    if(!vegCategories.includes(elem.category)){
                        vegCategories.push(elem.category)
                    }
                })
                vegCategories.forEach((element,index )=>{
                    finalData.menuData.menu.forEach(e =>{
                        if(element == e.category){
                            a += 1;
                        }
            
            
                    })
                    document.querySelector('.catUl').innerHTML += `<li id="${element}">${element} (${a})</li>`
                    let containerData = `<div class="specify-div" >
                        <button class="specify-head"  data-tab-target="${element}" data-tab-status="open">${element} (${a}) <i class="bi bi-caret-down-fill"></i></button>
                        <div class="menu-inner-wrap-con menu-inner-wrap-con${index}" id="${element}" data-tab-content="${element}">
                        </div>
                        </div>
                        `
                           menuWrapCon.innerHTML += containerData; 
                           
                    vegData.forEach(elem=>{
            
                        const containerDiv = document.querySelector(`.menu-inner-wrap-con${index}`);
            
                        
                        if(element == elem.category){
                              let typeData;
                  let quantityData = '';

                           if(elem.type == "Non-veg"){
                               typeData = `<img src="https://img.icons8.com/fluency/50/000000/non-vegetarian-food-symbol.png" alt="">`
                           }else{
                               typeData = `<img src="https://img.icons8.com/fluency/50/000000/non-vegetarian-food-symbol.png" alt="">`
                           } 

                           elem.quantityDetails.forEach((element , index)=>{
                                if(index == 0){
                                    quantityData += `<div class="quantity-div">
                                    <input type="radio" name="${elem._id}" value='${element.quantity} ${element.quantityUnit}' data-tab-id=${elem._id}  data-tab-price=${element.price} onchange="changeBtn(this)" checked> 
                                    <label for="quantity1">${element.quantity} ${element.quantityUnit}</label>
                                    </div>`
                                }else{
                                    quantityData += `<div class="quantity-div">
                                    <input type="radio" name="${elem._id}" value='${element.quantity} ${element.quantityUnit}' data-tab-id=${elem._id}  data-tab-price=${element.price} onchange="changeBtn(this)">
                                    <label for="quantity1">${element.quantity} ${element.quantityUnit}</label>
                                    </div>`
                                }
                           
            
                        })
                        let arr = JSON.parse(localStorage.getItem(id)) || []
                        let btn;
                        if(arr.length < 1){
                             btn = `<button class="add-to-cart" id="${elem._id}" data-tab-target="addToCart">Add</button>`
                        }else{
                             for(let [index,i] of arr.entries()){
                            let quantity = `${elem.quantityDetails[0].quantity} ${elem.quantityDetails[0].quantityUnit}`
                            console.log(quantity);
                            if(i.foodId == elem._id){
        
                                if(i.foodQuantity == quantity){
                                    btn = `<div class="btn-con">
                                    <button ><span><i class="bi bi-dash" onclick="removeFromCart('${i.foodId}' , '${i.foodQuantity}' , this);"></i></span></button>
                                    <input class="quantity ${i.foodId}" min="1" max="15" name="food-quantity" value="${i.cartQuantity}" type="number"  data-id="${i.foodId}">
                                    <button ><span><i class="bi bi-plus" id="${i.foodId}" data-tab-target="addToCart" ></i></span></button>
                                    </div>`
                                    break;
                                }else{
                                        btn = `<button class="add-to-cart" id="${elem._id}" data-tab-target="addToCart">Add</button>`
                                }
        
                            }else{
                                
                                if(index == arr.length - 1){
                                    btn = `<button class="add-to-cart" id="${elem._id}" data-tab-target="addToCart">Add</button>`
                                }
                            }
                        } 
                        }
                       
                            let htmlData = `<div class="menu-item" >
                            <div class="item-wrap-con">
                            <div class="img-wrap-con">
                                    <div class="img-div">
                            <img src="/uploads/${elem.cuisineImg}" alt="" srcset="">
            
                            </div>
                            </div>
                            
                            <div class="item-details-div">
                                ${typeData}
                                <span class="item-name">${elem.cuisinename}</span>
                                <span class="item-price ">₹${elem.quantityDetails[0].price}</span>
            
                                
            
                            </div>
                            <div class="add-to-cart-div">
                                ${btn}
                                
                            </div>
                            </div>
                            
                       
                        <div class="quantity-wrap-div">

                            ${quantityData}
            
                                </div>
                                 <hr>
            
                        </div>`
                        containerDiv.innerHTML += htmlData
                        quantityData = ''
            
                        }   
                    })
                })
                tab.style.backgroundColor = "#3ea055"
                tab.style.color = "white"
                tab.style.borderColor = "#3ea055"

                tab.dataset.tabStatus = "active";
            }
            else{
                tab.style.backgroundColor = "white"
                tab.style.color = "black"
                tab.style.borderColor = "#afafaf"

                tab.dataset.tabStatus = "inactive";
                fillMenu()
            }
        }


    })
})














const tlN = new TimelineLite();
document.querySelector('.cart-absolute-div').addEventListener('click', ()=>{
    openCartMobile();
})
const openCartMobile = ()=>{

    const tabContainer = document.querySelector('.content-side-section-cart');
    document.body.classList.add('ovf');
    tlN.to(tabContainer, 0.5, {opacity: 1,
        display : "flex",
        top : window.scrollY,
        ease : Power2.easeinout      
   });
    
   
   

}

const closeCartMobile = ()=>{
  
  const tabContainer = document.querySelector('.content-side-section-cart');
    
    tlN.to(tabContainer, 0.5, {opacity: 0,
        display : "none",
        top : "100%",
        ease : Power2.easeinout      
   });
}

// let preCookId = window.location.href.substring(window.location.href.indexOf('/nfc') + 1).split(['/'])[1];
// const callF = ()=>{
//     if(localStorage.getItem(preCookId)){
//         displayCart()
       
//     }
// }
// callF()

// displayCart()

//displayCart()





</script>
<script src="/socket.io/socket.io.js"></script>
<script src="/js/socketTakeaway.js"></script>

<script src="/js/menuAnimation.js"></script>

<script src="/js/addToCart.js"></script>

</html>
</html>